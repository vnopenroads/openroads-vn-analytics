- block:

  # - name: Create log directory
  #   ansible.builtin.file:
  #     path: "/home/ubuntu/log"
  #     state: directory

  # - name: Setup APT Sources for Node/Yarn
  #   shell: "{{ item }}"
  #   with_items: 
  #   - "curl -sL https://deb.nodesource.com/setup_14.x | bash -"
  #   - "curl -sL https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -"
  #   - "echo 'deb https://dl.yarnpkg.com/debian/ stable main' > /etc/apt/sources.list.d/yarn.list"
  #   become: true

  # - name: install Node/Yarn
  #   apt: 
  #     update_cache: true
  #     pkg: 
  #       - nodejs
  #       - yarn
  #       - make
  #       - gcc
  #       - g++
  #   become: true

  # - name: Create app directory
  #   ansible.builtin.file:
  #     path: "{{ node_app_dir }}"
  #     state: directory

  - name: Deploy the api source 
    synchronize:
      src: "{{ api_src_dir }}/{{ item }}"
      dest: "{{ node_app_dir }}/"
    with_items: 
      - src
      - db
      - index.js
      - package.json
    notify: restart supervisord
  
  - name: Yarn Install
    command: id
      # cmd: yarn install
      # chdir: "{{ node_app_dir }}"
    notify: restart supervisord

  tags: node-app
